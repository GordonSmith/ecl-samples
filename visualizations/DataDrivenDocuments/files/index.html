<!doctype html>
<html>
<head>
    <title>Conf2013 by GordonSmith</title>
    <script src="js/config.js"></script>
    <script src="http://192.168.1.201:8010/esp/files/dojo/dojo.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
</head>
<body>
    <h2>Choropleth</h2>
    <p id="cpleth"></p>
    <h2>Tree</h2>
    <h3>Cluster Dendrogram</h3>
    <p id="cd"></p>
    <h3>Reingold Tilford Tree</h3>
    <p id="rtt"></p>
    <h3>Sunburst Partition</h3>
    <p id="sp"></p>
    <h3>Circle Packing</h3>
    <p id="P1"></p>
    <h2>Graphs</h2>
    <h3>Force Directed</h3>
    <p id="fd"></p>
    <h3>Co Occurance</h3>
    <p id="co" style="width:920px"></p>
    <script>
        require([
            "hpcc/WsWorkunits",
            "hpcc/ESPWorkunit",

            "js/DojoD3Chart",
            "js/DojoD3Tree",
            "js/DojoD3Graph",

            "dojo/domReady!"], function (WsWorkunits, ESPWorkunit, d3Chart, d3Tree, d3Graph) {

                var wuStore = ESPWorkunit.CreateWUQueryStore();

                //  Tree  ---
                wuStore.query({
                    Jobname: "Tree"
                }).then(function (response) {
                    if (response.length) {
                        var wu = response[0];
                        wu.fetchNamedResults(["statezips"]).then(function (results) {
                            var tree = new d3Tree("States", results.statezips, {
                                label: "label",
                                value: "stat",
                                children: "kids"
                            });
                            tree.CirclePacking({
                                domNode: "#cp"
                            });
                            tree.SunburstPartition({
                                domNode: "#sp"
                            });
                            tree.ReingoldTilfordTree({
                                domNode: "#rtt"
                            });
                            tree.ClusterDendrogram({
                                domNode: "#cd"
                            });
                        });
                    }
                });

                //  Graph and Choropleth  ---
                wuStore.query({
                    Jobname: "DataDrivenDocuments"
                }).then(function (response) {
                    if (response.length) {
                        var wu = response[0];
                        wu.fetchNamedResults(["unemployement", "vertices", "edges"]).then(function (results) {
                            //  Choropleth  ---
                            var chart = new d3Chart("Unemployement", results.unemployement, {
                                x: "id",
                                y: "rate"
                            });
                            chart.Choropeth({
                                domNode: "#cpleth"
                            });

                            //  Graph  ---
                            var graph = new d3Graph("Miserables", results.vertices, {
                                index: "id",
                                name: "name",
                                category: "category"
                            }, results.edges, {
                                source: "source",
                                target: "target",
                                weight: "weight"
                            });
                            graph.ForceDirected({
                                domNode: "#fd"
                            });
                            graph.CoOccurrence({
                                domNode: "#co",
                                width: 720,
                                height: 720
                            });
                        });
                    }
                });
            });
    </script>
</body>
</html>
